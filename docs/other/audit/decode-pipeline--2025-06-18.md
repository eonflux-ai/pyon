# Pyon Decode Pipeline â€” Final Audit Summary

## ðŸ“š Table of Contents

1. [Overview](#1-overview)
2. [General Guarantees](#2-general-guarantees-confirmed)
3. [Types That Invoke Constructors](#3-types-that-invoke-constructors)
4. [Notes on `File` Type](#4-notes-on-file-type)
5. [Documentation Recommendations](#5-documentation-recommendations)
6. [Fully Conformant Modules](#6-fully-conformant-modules)
7. [Modules with Documented Caveats](#7-modules-with-documented-caveats)
8. [Next Steps](#8-next-steps)
9. [About](#9-about)

---

## 1. Overview

This document consolidates the findings of a full audit of Pyon's decoding pipeline (June 2025). The goal was to validate the library's guarantee:

> *Pyon does not execute methods, custom constructors, or evaluation logic during decoding. Reflection is used to identify types, and attributes are restored via direct assignment.*

The review confirms that this principle is upheld **in most cases**, with **clear exceptions** for types whose constructors are inherently required (e.g., pandas, numpy, File). These exceptions are documented below.

---

## 2. General Guarantees (Confirmed)

- All types are resolved via reflection using `importlib` and `getattr`.
- Default object reconstruction is performed using `__new__` + direct attribute assignment.
- No methods (`__init__`, `__post_init__`, `from_json`, etc.) are invoked implicitly.

---

## 3. Types That Invoke Constructors

| Type / Class               | Location               | Constructor Invoked?    | Notes                                        |
| -------------------------- | ---------------------- | ------------------------ | -------------------------------------------- |
| `decimal.Decimal`          | `numeric_types.py`     | âœ… Yes                   | Native type, predictable.                    |
| `datetime`, `date`, `time` | `datetime_types.py`    | âœ… Yes (`fromisoformat`) | No side effects.                             |
| `defaultdict`              | `collection_types.py`  | âœ… Yes                   | `default_factory` may contain logic.         |
| `namedtuple`               | `collection_types.py`  | âœ… Yes                   | Subclasses may include logic.                |
| `numpy.ndarray`            | `specialized_types.py` | âœ… Yes (`array(...)`)    | Safe **only if** built from pure lists.      |
| `pandas.DataFrame/Series`  | `specialized_types.py` | âœ… Yes                   | Known, controlled constructors.              |
| `File`                     | `specialized_types.py` | âœ… Yes (`from_dict`)     | Internally validated, but can be tampered.   |
| `Enum`                     | `mapping_types.py`     | âœ… Yes                   | May call `__new__`, which can include logic. |

---

## 4. Notes on `File` Type

- The content of `.pyon` files can be modified manually.
- A malicious actor may inject binary or textual content into the `content` field, resulting in unexpected behavior when calling `write_temp()` or accessing `path`.
- The `File` type itself **does not execute code**, but manipulated content **may carry instructions**, depending on how it is used.

---

## 5. Documentation Recommendations

1. **Add a section for constructor-required types:**
   - Indicate that `decimal`, `datetime`, `pandas`, etc. use constructors by design.

2. **Explicitly document partial safety risks:**
   - Types like `Enum`, `defaultdict`, `namedtuple`, `File`, and `ndarray` require caveats.

3. **Future suggestions:**
   - Introduce a `safe_mode` with type filtering.
   - Validate that fields were originally generated by Pyon's own `encode()`.

---

## 6. Fully Conformant Modules

- `base_encoder.py`
- `encoder.py`
- `base_types.py`
- `numeric_types.py`
- `datetime_types.py`
- `mapping_types.py` (except Enum)

---

## 7. Modules with Documented Caveats

- `collection_types.py`
- `specialized_types.py`

---

## 8. Next Steps

- [ ] Update the project documentation (`README.md`) to reflect audit findings.
- [x] Create a dedicated `SECURITY.md` file and include the detailed security overview.
- [ ] Implement optional safeguards such as `safe_mode`, `allow-lists`, or decoding assertions.
- [ ] Write automated tests to assert no constructor/method is executed during standard decode.
- [ ] Validate that complex types like `ndarray` are built from lists only.
- [ ] Optionally consider hashing or signing content in `File` objects.

---

## 9. About

Type: **Internal Audit**  
Audit by: **Eduardo Rodrigues (eonflux-ai)**  
Date: **June 18, 2025**
