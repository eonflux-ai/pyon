
# Pyon Decode Pipeline ‚Äî Final Audit Summary (it - internal)

## ‚ú® Overview
This document consolidates the findings of a full audit of Pyon's decoding pipeline (June 2025). The goal was to validate the library's core guarantee:

> *Pyon does not execute methods, custom constructors, or evaluation logic during decoding. Reflection is used to identify types, and attributes are restored via direct assignment.*

The review confirms that this principle is upheld **in most cases**, with **clear exceptions** for types whose constructors are inherently required (e.g., pandas, numpy, File). These exceptions are documented below.

---

## ‚úÖ General Guarantees (Confirmed)
- All types are resolved via reflection using `importlib` and `getattr`.
- Default object reconstruction is performed using `__new__` + direct attribute assignment.
- No methods (`__init__`, `__post_init__`, `from_json`, etc.) are invoked implicitly.

---

## ‚ö†Ô∏è Types That Invoke Constructors

| Type / Class                | Location                 | Constructor Invoked? | Notes |
|----------------------------|--------------------------|-----------------------|-------|
| `decimal.Decimal`          | `numeric_types.py`       | ‚úÖ Yes                | Native type, predictable.
| `datetime`, `date`, `time` | `datetime_types.py`      | ‚úÖ Yes (`fromisoformat`) | No side effects.
| `defaultdict`              | `collection_types.py`    | ‚úÖ Yes                | `default_factory` may contain logic.
| `namedtuple`               | `collection_types.py`    | ‚úÖ Yes                | Subclasses may include logic.
| `numpy.ndarray`            | `specialized_types.py`   | ‚úÖ Yes (`array(...)`) | Safe **only if** built from pure lists.
| `pandas.DataFrame/Series`  | `specialized_types.py`   | ‚úÖ Yes                | Known, controlled constructors.
| `File`                     | `specialized_types.py`   | ‚úÖ Yes (`from_dict`)  | Internally validated, but can be tampered.
| `Enum`                     | `mapping_types.py`       | ‚úÖ Yes                | May call `__new__`, which can include logic.

---

## üìÑ Notes on `File` Type
- The content of `.pyon` files can be modified manually.
- A malicious actor may inject binary or textual content into the `content` field, resulting in unexpected behavior when calling `write_temp()` or accessing `path`.
- The `File` type itself **does not execute code**, but manipulated content **may carry instructions**, depending on how it is used.

---

## üí° Documentation Recommendations

1. **Add a section for constructor-required types:**
   - Indicate that `decimal`, `datetime`, `pandas`, etc. use constructors by design.

2. **Explicitly document partial safety risks:**
   - Types like `Enum`, `defaultdict`, `namedtuple`, `File`, and `ndarray` require caveats.

3. **Future suggestions:**
   - Introduce a `safe_mode` with type filtering.
   - Validate that fields were originally generated by Pyon's own `encode()`.

---

## ‚úÖ Fully Conformant Modules
- `base_encoder.py`
- `encoder.py`
- `base_types.py`
- `numeric_types.py`
- `datetime_types.py`
- `mapping_types.py` (except Enum)

## ‚ö†Ô∏è Modules with Documented Caveats
- `collection_types.py`
- `specialized_types.py`

---

## üöÄ Next Steps
- [ ] Integrate this summary into `README.md` or create a dedicated `SECURITY.md`.
- [ ] Write tests to ensure `__init__` is never implicitly called.
- [ ] Validate pure list fields for `ndarray`.
- [ ] Consider hashing or signing content within `File` objects (future).

---

This audit confirms that Pyon maintains a controlled and predictable decoding pipeline, with a few traceable and well-documented exceptions. No arbitrary code execution was identified, and all exceptions are tied to standard libraries and expected behavior.
